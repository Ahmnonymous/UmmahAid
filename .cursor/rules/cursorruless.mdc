---
alwaysApply: true
---
# ============================================================
# üîπ GLOBAL CURSOR RULESET - ULTIMATE FULL-STACK ENGINEERING GUIDE
# ============================================================
runtime:
  priority_mode: performance
  disable_full_context_analysis: true

meta:
  name: "UmmahAid Enterprise Development Ruleset"
  version: 5.0
  description: |
    Generic, adaptive, full-stack rules for Cursor AI across all projects using
    React + Node/Express + PostgreSQL. Includes automatic folder detection,
    smart naming, RBAC enforcement, audit injection, design replication, and
    developer-style communication patterns.
  load_mode: selective       # ‚úÖ only loads active rule groups
  prefetch: false            # ‚úÖ prevents full eager loading

performance:
  cache_scans: true
  cache_reasoning: true
  cache_schema_map: true
  incremental_analysis: true
  max_context_depth: 2   # limit how far back it looks for context
  skip_validation_if_unchanged: true

reasoning:
  depth_limit: 3        # ‚úÖ restricts multi-hop reasoning
  skip_noncritical_checks: true
  auto_trust_known_patterns: true

ai_behavior:
  verbosity: low
  infer_context_from_path: true
  skip_restatement: true

# ============================================================
# üîπ CORE DEVELOPMENT PRINCIPLES
# ============================================================
general_guidelines:
  - Maintain design + logic uniformity across the app.
  - Do not break existing functionality when adjusting components or APIs.
  - Ask only if schema or RBAC logic is ambiguous.
  - Favor component reuse ‚Äî if new, replicate design from a confirmed existing component.
  - Use structured reasoning: confirm flow ‚Üí confirm RBAC ‚Üí then generate.
  - Follow same layout pattern for modals, tables, and forms.
  - Confirm dark/light compatibility and responsive behavior.

# ============================================================
# üîπ SMART FOLDER MAP
# ============================================================
smart_folder_map:
  enabled: true
  detect_once: true
  detection_strategy:
    - Scan `src/` and `backend/src/` for folder patterns:
        components: ["components"]
        pages: ["pages"]
        services: ["services"]
        store: ["store"]
        helpers: ["helpers"]
        backend: ["backend"]
  cache_results: true           # ‚úÖ speeds up subsequent scans
  ask_on_conflict: false         # skip asking each time
  memory_persist: true           # reuse from previous sessions

# ============================================================
# üîπ FRONTEND RULES
# ============================================================
frontend_rules:
  - Place new pages under `src/pages/[FeatureName]/`
  - Reusable UI ‚Üí `src/components/`
  - Use React Hook Form for inputs
  - Use `axiosApi` for backend calls (JWT auto-handled)
  - Use validation + formatting helpers from `src/helpers`
  - Auto-detect current user info (localStorage, Redux, Context)
  - Maintain consistent Skote/MUI design and structure
  - Ask before creating or changing conditional field logic
  - Always include audit metadata (`created_by`, `updated_by`, timestamps)
  - Auto-apply dark/light themed DataTable + pagination + modal consistency

# ============================================================
# üîπ BACKEND RULES
# ============================================================
backend_rules:
  - Place code in standard folders:
      routes ‚Üí backend/src/routes/
      controllers ‚Üí backend/src/controllers/
      models ‚Üí backend/src/models/
  - Wrap DB calls with try/catch
  - Use parameterized queries to prevent SQL injection
  - Auto-apply `created_by`, `updated_by`, `created_at`, `updated_at`
  - Enforce `req.user.center_id` for tenant isolation (except SuperAdmin)
  - Use `roleMiddleware()` for RBAC enforcement
  - Return clean JSON (no bytea/base64 blobs)
  - Maintain audit consistency across models

# ============================================================
# üîπ RBAC HIERARCHY
# ============================================================
rbac_rules:
  - AppAdmin:
      description: Full access to all centers and all modules
      permissions:
        - CRUD: all
        - Center navigation: allowed
        - Special restrictions: none
        - Reports: all centers
        - Policy & Procedure: create, edit, view
        - Supplier & Inventory: visible and editable

  - HQ:
      description: Same as AppAdmin, except cannot create centers
      permissions:
        - CRUD: all modules
        - Center navigation: allowed
        - Create center: denied
        - Reports: all centers
        - Policy & Procedure: create, edit, view
        - Supplier & Inventory: visible and editable

  - OrgAdmin:
      description: Access restricted to own center data
      permissions:
        - CRUD: full within assigned center only
        - Center navigation: hidden
        - Other navigation: allowed
        - Reports: only their own center
        - Policy & Procedure: view only
        - Supplier & Inventory: hidden

  - OrgExecutive:
      description: Read-only access to own center
      permissions:
        - CRUD: read-only within assigned center
        - Center navigation: hidden
        - FileManager navigation: hidden
        - Chat navigation: denied
        - Reports: only their own center
        - Policy & Procedure: view only
        - Supplier & Inventory: hidden

  - OrgCaseworker:
      description: Restricted CRUD within own center
      permissions:
        - CRUD: full within assigned center
        - Center navigation: hidden
        - FileManager navigation: allowed and visible
        - Inventory navigation: denied
        - Supplier navigation: denied
        - Meetings Management navigation: denied
        - Reports: only their own center
        - Policy & Procedure: view only

  - AutoFilters:
      - Always filter data by `center_id` unless AppAdmin or HQ
      - Apply role-specific navigation restrictions automatically
      - Confirm with user if applying or skipping role-based filters

Additional global rules:
  - HQ and AppAdmin see all reports (multi-center)
  - OrgAdmin, OrgExecutive, and OrgCaseworker see only their own center‚Äôs reports
  - All employees can view the Policy & Procedure page
  - Only AppAdmin and HQ can create or edit policies/procedures
  - Supplier and Inventory modules are visible only to AppAdmin and HQ
  - FileManager navigation hidden for OrgExecutive, shown for OrgCaseworker
  - OrgExecutive has read-only permissions in all accessible modules

# ============================================================
# üîπ USER STORAGE AUTO-DETECTION
# ============================================================
auto_detection_rules:
  - Detects user info automatically from:
      - localStorage (authUser, currentUser, user)
      - Redux store (`state.user` or `state.auth`)
      - React Context (useAuth, useUser)
  - If multiple found, confirm preferred one.
  - Use username or name property for audit logging.

# ============================================================
# üîπ AUTO AUDIT FIELD INJECTION
# ============================================================
cursor_injection_rules:
  alwaysApply: true
  inject_before_save:
    - |
      // ===================================================
      // üîπ UNIVERSAL AUTO-AUDIT FIELD HANDLER
      // ===================================================
      let currentUser;
      try {
        currentUser =
          JSON.parse(localStorage.getItem("authUser")) ||
          JSON.parse(localStorage.getItem("currentUser")) ||
          JSON.parse(localStorage.getItem("user")) ||
          {};
      } catch (e) { currentUser = {}; }

      const username = currentUser?.username || currentUser?.name || "system";

      if (editItem) {
        formData.updated_by = username;
        formData.updated_at = new Date().toISOString();
      } else {
        formData.created_by = username;
        formData.created_at = new Date().toISOString();
      }

# ============================================================
# üîπ SMART NAMING CONVENTIONS
# ============================================================
smart_naming_conventions:
  enabled: true
  auto_confirm: true          # ‚úÖ skips confirmation checks
  rules:
    frontend:
      - Report pages ‚Üí `<EntityName>Report.jsx`
      - Detail views ‚Üí `<EntityName>Detail.jsx`
      - Tables ‚Üí `<EntityName>Table.jsx`
      - Services ‚Üí `<EntityName>Service.js`
      - Redux/context ‚Üí `<entityName>Slice.js` or `<EntityName>Context.js`
    backend:
      - Controller ‚Üí `<entityName>Controller.js`
      - Model ‚Üí `<entityName>Model.js`
      - Routes ‚Üí `<entityName>Routes.js`
      - Middleware ‚Üí `<entityName>Middleware.js`
      - Tests ‚Üí `<entityName>.test.js`

# ============================================================
# üîπ VALIDATION & TESTING
# ============================================================
validation:
  full_project_scan: false
  validate_only_changed_files: true
  skip_static_analysis_on_small_changes: true

testing_rules:
  - Frontend ‚Üí React Testing Library + Cypress
  - Backend ‚Üí Jest + Supertest
  - Run lint + tests before commit
  - Verify RBAC + tenant filtering work for all roles

# ============================================================
# üîπ DESIGN CONSISTENCY
# ============================================================
ui_guidelines:
  - Follow identical Normal/Modal Page structure everywhere
  - Maintain button placement, spacing, and typography
  - Match field alignment and card layout to Skote standard
  - Ask user which component to replicate before building a new one
  - Validate both dark and light modes before finalizing

# ============================================================
# üîπ AI CLARIFICATION TEMPLATES
# ============================================================
ai_clarification_templates:
  tone: "Professional, direct"
  ask_before_actions:
    - Only ask when module type or folder is unclear.
  confirmation_examples:
    - ‚ÄúConfirm same layout as StudentDetailDrawer?‚Äù
  refusal_guidelines:
    - ‚ÄúSkipping to avoid breaking existing logic ‚Äî confirm if override needed.‚Äù

# ============================================================
# üîπ COMMUNICATION STYLE SUMMARY
# ============================================================
communication_guidelines:
  - Always clarify uncertainty before action.
  - Prioritize accuracy and consistency over speed.
  - Use the same tone across backend and frontend clarification.
  - Speak as a proactive senior dev, not as a generic assistant.
  - Example phrasing:
      - ‚ÄúTo confirm, should this match your Applicant layout?‚Äù
      - ‚ÄúDo you want the same conditional visibility logic as UniversityDetails?‚Äù
      - ‚ÄúShould I auto-apply RBAC filters for OrgAdmin and Caseworker?‚Äù

performance_summary:
  optimization_level: high
  prefer_speed_over_explanation: true
  confirm_major_changes_only: true
  enable_background_indexing: true
